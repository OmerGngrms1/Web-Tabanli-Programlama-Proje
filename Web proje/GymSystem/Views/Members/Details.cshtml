@model GymSystem.Models.Member

@{
    ViewData["Title"] = "Üye Detayları";
}

<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow">
            <div class="card-header bg-info text-white">
                <h4 class="mb-0"><i class="fas fa-user"></i> Üye Detayları</h4>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-4">@Html.DisplayNameFor(model => model.Name)</dt>
                    <dd class="col-sm-8">@Html.DisplayFor(model => model.Name)</dd>

                    <dt class="col-sm-4">@Html.DisplayNameFor(model => model.Surname)</dt>
                    <dd class="col-sm-8">@Html.DisplayFor(model => model.Surname)</dd>

                    <dt class="col-sm-4">@Html.DisplayNameFor(model => model.Gender)</dt>
                    <dd class="col-sm-8">@Html.DisplayFor(model => model.Gender)</dd>

                    <dt class="col-sm-4">@Html.DisplayNameFor(model => model.Email)</dt>
                    <dd class="col-sm-8">@Html.DisplayFor(model => model.Email)</dd>

                    <dt class="col-sm-4">@Html.DisplayNameFor(model => model.Phone)</dt>
                    <dd class="col-sm-8">@Html.DisplayFor(model => model.Phone)</dd>

                    <dt class="col-sm-4">@Html.DisplayNameFor(model => model.DurationInMonths)</dt>
                    <dd class="col-sm-8">@Html.DisplayFor(model => model.DurationInMonths) Ay</dd>

                    <dt class="col-sm-4">@Html.DisplayNameFor(model => model.RegistrationDate)</dt>
                    <dd class="col-sm-8">@Html.DisplayFor(model => model.RegistrationDate)</dd>

                    <dt class="col-sm-4">@Html.DisplayNameFor(model => model.EndDate)</dt>
                    <dd class="col-sm-8">@Html.DisplayFor(model => model.EndDate)</dd>

                    <dt class="col-sm-4">@Html.DisplayNameFor(model => model.Age)</dt>
                    <dd class="col-sm-8">@(Model.Age.HasValue ? Model.Age + " Yaş" : "-")</dd>

                    <dt class="col-sm-4">@Html.DisplayNameFor(model => model.Weight)</dt>
                    <dd class="col-sm-8">@(Model.Weight.HasValue ? Model.Weight + " kg" : "-")</dd>

                    <dt class="col-sm-4">@Html.DisplayNameFor(model => model.Height)</dt>
                    <dd class="col-sm-8">@(Model.Height.HasValue ? Model.Height + " cm" : "-")</dd>

                    <dt class="col-sm-4">Antrenman Programı</dt>
                    <dd class="col-sm-8">
                        @if (Model.WorkoutProgram != null)
                        {
                            <span>@Model.WorkoutProgram.Name</span>
                        }
                        else
                        {
                            <span class="text-muted">Atanmadı</span>
                        }
                    </dd>

                    <dt class="col-sm-4">Diyet Planı</dt>
                    <dd class="col-sm-8">
                        @if (Model.DietPlan != null)
                        {
                            <span>@Model.DietPlan.Name</span>
                        }
                        else
                        {
                            <span class="text-muted">Atanmadı</span>
                        }
                    </dd>
                </dl>
            </div>
            <div class="card-footer d-flex justify-content-center">
                <a asp-action="Index" class="btn btn-secondary">Listeye Dön</a>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4 justify-content-center">
    <!-- Weight Chart Column -->
    <div class="col-md-5">
        <div class="card shadow-sm border-0 h-100">
             <div class="card-header bg-white border-0 pt-4 px-4">
                <h5 class="fw-bold mb-0 text-info"><i class="fas fa-chart-line me-2"></i>Kilo Gelişimi</h5>
            </div>
            <div class="card-body">
                <canvas id="weightChart" style="max-height: 250px;"></canvas>
                 @if(ViewBag.WeightHistory != null)
                {
                    var history = (List<GymSystem.Models.MemberWeight>)ViewBag.WeightHistory;
                    if(history.Any())
                    {
                        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                        <script>
                            document.addEventListener("DOMContentLoaded", function() {
                                const ctx = document.getElementById('weightChart').getContext('2d');
                                const dates = @Json.Serialize(history.Select(x => x.Date.ToString("dd.MM")));
                                const weights = @Json.Serialize(history.Select(x => x.Weight));

                                new Chart(ctx, {
                                    type: 'line',
                                    data: {
                                        labels: dates,
                                        datasets: [{
                                            label: 'Kilo (kg)',
                                            data: weights,
                                            borderColor: '#0ea5e9',
                                            backgroundColor: 'rgba(14, 165, 233, 0.1)',
                                            borderWidth: 2,
                                            fill: true,
                                            tension: 0.4
                                        }]
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        plugins: {
                                            legend: { display: false }
                                        },
                                        scales: {
                                            y: { beginAtZero: false }
                                        }
                                    }
                                });
                            });
                        </script>
                    }
                     else
                    {
                        <p class="text-muted small text-center">Henüz veri yok.</p>
                    }
                }
            </div>
        </div>
    </div>

    <!-- Attendance History Column -->
    <div class="col-md-3">
        <div class="card shadow-sm border-0 h-100">
             <div class="card-header bg-white border-0 pt-4 px-4">
                <h5 class="fw-bold mb-0 text-danger"><i class="fas fa-calendar-check me-2"></i>Yoklama Geçmişi</h5>
            </div>
            <div class="card-body px-4 overflow-auto" style="max-height: 350px;">
                @if(ViewBag.AttendanceHistory != null)
                {
                    var attendance = (List<GymSystem.Models.Attendance>)ViewBag.AttendanceHistory;
                    if(attendance.Any())
                    {
                        <ul class="list-group list-group-flush">
                            @foreach(var item in attendance)
                            {
                                <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent">
                                    <span>@item.Date.ToString("dd.MM.yyyy")</span>
                                    <span class="badge bg-success rounded-pill"><i class="fas fa-check"></i></span>
                                </li>
                            }
                        </ul>
                    }
                    else
                    {
                        <p class="text-muted text-center my-4">Henüz katılım kaydı yok.</p>
                    }
                }
            </div>
        </div>
    </div>
</div>
